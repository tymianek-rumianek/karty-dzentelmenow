<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 script-src 'self' https://www.gstatic.com https://www.gstatic.com/firebasejs/ 'unsafe-inline';
                 connect-src 'self' https://*.googleapis.com https://*.gstatic.com https://*.firebaseio.com https://*.firebaseinstallations.googleapis.com data: blob:;
                 img-src 'self' data: https:;
                 style-src 'self' 'unsafe-inline';
                 font-src 'self' data:;" />
  <title>Karty Dżentelmenów — Online</title>

  <style>
    *{box-sizing:border-box}
    html,body{margin:0;background:#fff;color:#000;font-family:Inter,Arial,sans-serif}
    .wrap{max-width:1400px;margin:0 auto;padding:16px;display:flex;flex-direction:column;gap:16px}
    header{display:flex;justify-content:space-between;align-items:center;padding-bottom:8px;border-bottom:1px solid #000}
    .title{font-weight:800;font-size:18px}
    .hidden{display:none}
    .small{font-size:12px}

    /* ===== Pasek graczy: nick NAD prostokątem ===== */
    .players-bar{
      position:sticky;top:8px;z-index:10;
      display:flex;gap:18px;align-items:flex-end;justify-content:center;flex-wrap:wrap;padding:10px 0 22px;
    }
    .player{
      display:flex;flex-direction:column;align-items:center;gap:6px;min-width:100px
    }
    .player-name{font-size:13px;font-weight:600;line-height:1}
    .player-slot{
      width:100px;height:22px;border:1px solid #000;border-radius:4px;background:#fff
    }
    .player.active .player-slot{background:#000}

    /* ===== Plansza: 1fr / auto / 1fr => karta jest idealnie pośrodku ===== */
    .board{
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      gap:48px;
      align-items:start;
      min-height:72vh;
    }

    /* wyrównania boczne, żeby było symetrycznie */
    .ctrl{justify-self:end;width:280px;border:1px solid #000;border-radius:8px;padding:14px;background:#fff;position:sticky;top:56px}
    .hand{justify-self:start;width:min(36vw,620px);border:1px solid #000;border-radius:8px;padding:14px;background:#fff}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .col{display:flex;flex-direction:column;gap:6px}
    input{border:1px solid #000;border-radius:6px;padding:8px 10px}
    button{border:1px solid #000;border-radius:6px;padding:10px 14px;font-weight:700;background:#000;color:#fff;cursor:pointer}
    button.ghost{background:#fff;color:#000}
    .badge{display:inline-block;border:1px solid #000;border-radius:999px;padding:4px 10px}

    /* ===== Czarna karta — mniejsza i dokładnie wycentrowana ===== */
    .prompt-wrap{
      grid-column:2; /* środkowa kolumna siatki */
      display:flex;align-items:center;justify-content:center;
      min-height:62vh;
    }
    .prompt{
      width:min(26vw,420px); /* MNIEJSZA */
      aspect-ratio:2.5/3.5;
      background:#000;color:#fff;border:1px solid #000;border-radius:8px;
      display:flex;align-items:center;justify-content:center;text-align:center;
      padding:18px;font-size:20px;overflow:hidden;
      transition:transform .22s ease,opacity .22s ease;
    }
    .prompt img{display:block;width:100%;height:100%;object-fit:cover}
    .prompt .fallback{padding:18px}

    /* ===== Ręka ===== */
    .hand-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    @media (max-width:1200px){ .hand-grid{grid-template-columns:repeat(3,1fr)} }
    .card-btn{
      border:1px solid #000;border-radius:8px;background:#fff;cursor:pointer;padding:0;
      width:100%;aspect-ratio:2.5/3.5;display:flex;align-items:center;justify-content:center;overflow:hidden;
      transition:transform .15s ease
    }
    .card-btn:hover{transform:translateY(-2px)}
    .card-btn img{width:100%;height:100%;object-fit:cover;display:block}
    .card-btn .fallback{padding:10px;font-size:12px;text-align:center}

    /* Podgląd */
    .preview{position:fixed;inset:0;pointer-events:none;z-index:30;display:flex;align-items:center;justify-content:center;opacity:0;transform:scale(.98);transition:opacity .18s ease,transform .18s ease}
    .preview.visible{opacity:1;transform:scale(1)}
    .preview-card{
      width:min(50vw,640px);aspect-ratio:2.5/3.5;border:1px solid #000;border-radius:8px;background:#fff;
      box-shadow:0 10px 30px rgba(0,0,0,.20);overflow:hidden;display:flex;align-items:center;justify-content:center
    }
    .preview-card img{width:100%;height:100%;object-fit:cover;display:block}
    .preview-card .fallback{padding:16px;font-size:18px;text-align:center;color:#000}

    body.previewing .prompt{transform:translateX(-6vw) scale(.9)}
    .card{border:1px solid #000;border-radius:8px;padding:14px;background:#fff}
    .warn{border:1px solid #000;border-radius:6px;padding:8px;background:#fff1f1;color:#000}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title">Karty Dżentelmenów — Online</div>
    <div class="small" id="alert" class="warn hidden"></div>
  </header>

  <!-- Start (bez zmian) -->
  <section id="screen-home" class="card">
    <div class="row">
      <button id="go-create">Stwórz lobby</button>
      <button id="go-join" class="ghost">Dołącz do gry</button>
    </div>
  </section>

  <!-- Tworzenie (bez zmian) -->
  <section id="screen-create" class="card hidden">
    <div class="col" style="max-width:480px">
      <label class="small">Twój nick</label>
      <input id="create-nick" placeholder="np. Tymianek" />
      <div class="row">
        <button id="btn-create">Utwórz lobby</button>
        <button class="ghost" id="back1">Wróć</button>
      </div>
    </div>
  </section>

  <!-- Dołączanie (bez zmian) -->
  <section id="screen-join" class="card hidden">
    <div class="col" style="max-width:480px">
      <label class="small">Kod pokoju</label>
      <input id="join-code" placeholder="np. R4F7" />
      <label class="small">Twój nick</label>
      <input id="join-nick" placeholder="np. Gość" />
      <div class="row">
        <button id="btn-join">Dołącz</button>
        <button class="ghost" id="back2">Wróć</button>
      </div>
    </div>
  </section>

  <!-- Rozgrywka -->
  <section id="screen-room" class="hidden">
    <!-- Pasek graczy -->
    <div id="players" class="players-bar"></div>

    <div class="board">
      <!-- Lewy panel -->
      <aside class="ctrl">
        <div class="col">
          <div class="small">Pokój</div>
          <div class="row">
            <div class="badge">Kod: <b id="room-code">—</b></div>
            <button id="copy-code" class="ghost">Kopiuj</button>
          </div>
          <div class="small" style="margin-top:8px">Sterowanie</div>
          <div class="row">
            <button id="btn-start">Start rundy</button>
